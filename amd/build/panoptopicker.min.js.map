{"version":3,"file":"panoptopicker.min.js","sources":["../src/panoptopicker.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Functionality for the form element panoptopicker\n *\n * @module     repository_panopto/panoptopicker\n * @copyright  2017 Lancaster University (http://www.lancaster.ac.uk/)\n * @author     Ruslan Kabalin (https://github.com/kabalin)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification', 'core/url'], function($, ajax, templates, notification, url) {\n    /** @var {Number} contextid Context id. */\n    var contextid = 0;\n\n    var onChangeSessionId = function(event) {\n        if (event.target.value) {\n            $('#panoptopicker-area').empty();\n            addSpinner($('#panoptopicker-area'));\n            var promises = ajax.call([{\n                methodname: 'repository_panopto_get_session_by_id',\n                args: {sessionid: event.target.value, contextid: contextid},\n            }]);\n            promises[0].done(function(response) {\n                renderSessionInfo(response);\n            }).fail(function(ex) {\n                ex.backtrace = null;\n                notification.exception(ex);\n            });\n        }\n    };\n\n    var addSpinner = function(element) {\n        element.addClass('updating');\n        var spinner = element.find('img.spinner');\n        if (spinner.length) {\n            spinner.show();\n        } else {\n            spinner = $('<img/>')\n                    .attr('src', url.imageUrl('i/loading_small'))\n                    .addClass('spinner').addClass('smallicon')\n                ;\n            element.append(spinner);\n        }\n    };\n\n    var renderSessionInfo = function(data) {\n        // Render the template.\n        var context = {};\n        if (data.session) {\n            $.extend(context, data.session);\n        }\n        templates.render('repository_panopto/form_panoptopicker', context).done(function(newHTML) {\n            // Add it to the page.\n            $('#panoptopicker-area').empty().append($(newHTML).html());\n        }).fail(notification.exception);\n    };\n\n    return /** @alias module:repository_panopto/panoptopicker */ {\n\n        /**\n         * Initialise filepicker.\n         *\n         * @method init\n         * @param {array} options\n         */\n        init: function(options) {\n            contextid = options.contextid;\n            $('#' + options.elementid).on('change', onChangeSessionId).trigger('change');\n        }\n    };\n});\n"],"names":["define","$","ajax","templates","notification","url","contextid","onChangeSessionId","event","target","value","empty","addSpinner","call","methodname","args","sessionid","done","response","renderSessionInfo","fail","ex","backtrace","exception","element","addClass","spinner","find","length","show","attr","imageUrl","append","data","context","session","extend","render","newHTML","html","init","options","elementid","on","trigger"],"mappings":";;;;;;;;AAuBAA,0CAAO,CAAC,SAAU,YAAa,iBAAkB,oBAAqB,aAAa,SAASC,EAAGC,KAAMC,UAAWC,aAAcC,SAEtHC,UAAY,EAEZC,kBAAoB,SAASC,OACzBA,MAAMC,OAAOC,QACbT,EAAE,uBAAuBU,QACzBC,WAAWX,EAAE,wBACEC,KAAKW,KAAK,CAAC,CACtBC,WAAY,uCACZC,KAAM,CAACC,UAAWR,MAAMC,OAAOC,MAAOJ,UAAWA,cAE5C,GAAGW,MAAK,SAASC,UACtBC,kBAAkBD,aACnBE,MAAK,SAASC,IACbA,GAAGC,UAAY,KACflB,aAAamB,UAAUF,SAK/BT,WAAa,SAASY,SACtBA,QAAQC,SAAS,gBACbC,QAAUF,QAAQG,KAAK,eACvBD,QAAQE,OACRF,QAAQG,QAERH,QAAUzB,EAAE,UACH6B,KAAK,MAAOzB,IAAI0B,SAAS,oBACzBN,SAAS,WAAWA,SAAS,aAEtCD,QAAQQ,OAAON,WAInBP,kBAAoB,SAASc,UAEzBC,QAAU,GACVD,KAAKE,SACLlC,EAAEmC,OAAOF,QAASD,KAAKE,SAE3BhC,UAAUkC,OAAO,wCAAyCH,SAASjB,MAAK,SAASqB,SAE7ErC,EAAE,uBAAuBU,QAAQqB,OAAO/B,EAAEqC,SAASC,WACpDnB,KAAKhB,aAAamB,kBAGoC,CAQzDiB,KAAM,SAASC,SACXnC,UAAYmC,QAAQnC,UACpBL,EAAE,IAAMwC,QAAQC,WAAWC,GAAG,SAAUpC,mBAAmBqC,QAAQ"}